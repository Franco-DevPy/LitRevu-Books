{% extends 'reviews/base.html' %}
{% load static %}



{% block extra_css %}
{% if debug %}
<link rel="stylesheet" href="{% static 'reviews/css/abonnements.css' %}?v={% now 'U' %}">
{% else %}
<link rel="stylesheet" href="{% static 'reviews/css/abonnements.css' %}">
{% endif %}
{% endblock %}

{% block content %}
<section class="abonnementsSection">
    <div class="abonnementsSearch">
        <!-- Formulaire pour suivre un nouvel utilisateur -->
        <div class="searchBar">
            <form method="post" class="followForm">
                {% csrf_token %}
                <input type="hidden" name="action" value="follow">
                {{ form.username }}
                <button type="submit" class="searchButton" title="Suivre">
                    <iconify-icon width="30" icon="flowbite:user-add-solid" class="searchIcon"></iconify-icon>
                </button>
            </form>
        </div>
        <!-- Zone d'affichage pour de futurs résultats/suggestions (placeholder conservé) -->
        <div class="searchResults">
            {% if messages %}
            <div class="messages">
                {% for message in messages %}
                <div class="message {{ message.tags }}">{{ message }}</div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </div>
    <!-- Liste des abonnements actifs -->
    <div class="abonnementsCards">
        <h3>Abonnements actifs</h3>
        {% for rel in following_active %}
        <div class="abonnementsItem">
            <p>{{ rel.followed_user.username }}</p>
            <form method="post" class="inlineForm">
                {% csrf_token %}
                <input type="hidden" name="action" value="unfollow">
                <input type="hidden" name="target_id" value="{{ rel.id }}">
                <button type="submit" class="followButton" title="Désabonner">Désabonner</button>
            </form>
            <form method="post" class="inlineForm">
                {% csrf_token %}
                <input type="hidden" name="action" value="block">
                <input type="hidden" name="target_id" value="{{ rel.id }}">
                <button type="submit" class="followButton danger" title="Bloquer">Bloquer</button>
            </form>
        </div>
        {% empty %}
        <p class="empty">Vous ne suivez encore personne.</p>
        {% endfor %}
    </div>

    <!-- Liste des utilisateurs bloqués -->
    <div class="abonnesCards">
        <h3>Utilisateurs bloqués</h3>
        {% for rel in following_blocked %}
        <div class="abonnesItem">
            <p>{{ rel.followed_user.username }}</p>
            <form method="post" class="inlineForm">
                {% csrf_token %}
                <input type="hidden" name="action" value="unblock">
                <input type="hidden" name="target_id" value="{{ rel.id }}">
                <button type="submit" class="followButton" title="Débloquer">Débloquer</button>
            </form>
            <form method="post" class="inlineForm">
                {% csrf_token %}
                <input type="hidden" name="action" value="unfollow">
                <input type="hidden" name="target_id" value="{{ rel.id }}">
                <button type="submit" class="followButton danger" title="Supprimer la relation">Supprimer</button>
            </form>
        </div>
        {% empty %}
        <p class="empty">Aucun utilisateur bloqué.</p>
        {% endfor %}
    </div>

</section>
{% endblock %}