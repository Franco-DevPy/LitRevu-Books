{% extends 'reviews/base.html' %}
{% load static %}

{% block title %}Mes publications{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'reviews/css/mesposts.css' %}">
{% endblock %}

{% block content %}
<section class="loginSection">
    <!-- Colonne Tickets -->
    <div class="containerTickets">
        <div class="login-box boxTicket">
            <p id="responseTo">Vos Tickets</p>

            {% if tickets %}
            {% for ticket in tickets %}
            <div class="containerReview">
                <!-- Image / visuel du ticket -->
                <div class="imageContainer">
                    {% if ticket.image %}
                    <img src="{{ ticket.image.url }}" alt="Image ticket">
                    {% else %}
                    <img src="{% static 'images/image.png' %}" alt="Image ticket">
                    {% endif %}
                </div>

                <!-- Détails -->
                <div class="containerDetail">
                    <div>
                        <h3>{{ ticket.title|default:"(Sans titre)" }}</h3>
                        <p>{{ ticket.time_created|date:"d/m/Y H:i" }}</p>
                        <p class="author-label">{{ ticket.user.username }}</p>
                    </div>
                    <div>
                        <p class="description">
                            {{ ticket.description|default:"(Pas de description)" }}
                        </p>
                    </div>
                    <!-- Actions -->
                    <div class="actions-row">
                        <a class="btn-small" href="{% url 'modification-ticket' ticket.id %}">Modifier</a>
                        {% if ticket.id not in reviewed_ticket_ids %}
                        <a class="btn-small" href="{% url 'review_create' ticket.id %}">Ajouter une critique</a>
                        {% endif %}
                        <form method="post" action="{% url 'ticket_delete' ticket.id %}" class="inline-form"
                            onsubmit="return confirm('Supprimer ce ticket ?');">
                            {% csrf_token %}
                            <button type="submit" class="btn-delete">Supprimer</button>
                        </form>
                    </div>
                </div>
            </div>
            {% endfor %}
            {% else %}
            <p class="empty-msg">Aucun ticket créé.</p>
            {% endif %}
        </div>
    </div>

    <!-- Colonne Critiques -->
    <div class="containerCritiques">
        <div class="login-box boxTicket">
            <p id="responseTo">Vos Critiques</p>

            {% if reviews %}
            {% for review in reviews %}
            <div class="containerReview">
                <!-- Image du ticket associé -->
                <div class="imageContainer">
                    {% if review.ticket.image %}
                    <img src="{{ review.ticket.image.url }}" alt="Image ticket">
                    {% else %}
                    <img src="{% static 'images/image.png' %}" alt="Image ticket">
                    {% endif %}
                </div>

                <div class="containerDetail">
                    <div>
                        <h3>{{ review.headline|default:"(Sans titre)" }}</h3>
                        <p>{{ review.time_created|date:"d/m/Y H:i" }}</p>
                        <p class="author-label">{{ review.user.username }}</p>
                        <p class="note">Note : {{ review.rating }}/5</p>
                        <p class="ticket-ref">Ticket : {{ review.ticket.title|default:"(Sans titre)" }}</p>
                    </div>
                    <div>
                        <p class="description">{{ review.body|default:"(Pas de contenu)" }}</p>
                    </div>
                    <div class="actions-row">
                        <a class="btn-small" href="{% url 'review_edit' review.id %}">Modifier</a>
                        <form method="post" action="{% url 'review_delete' review.id %}" class="inline-form"
                            onsubmit="return confirm('Supprimer cette critique ?');">
                            {% csrf_token %}
                            <button type="submit" class="btn-delete">Supprimer</button>
                        </form>
                    </div>
                </div>
            </div>
            {% endfor %}
            {% else %}
            <p class="empty-msg">Aucune critique rédigée.</p>
            {% endif %}
        </div>
    </div>
</section>
{% endblock %}